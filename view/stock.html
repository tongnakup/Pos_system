<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</title>
    <style>
      /* Re-use CSS ‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ò‡∏µ‡∏°‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô */
      body {
        font-family: "Sarabun", sans-serif;
        margin: 0;
        background: #f4f6f9;
        display: flex;
      }
      .sidebar {
        width: 250px;
        background: #343a40;
        color: white;
        height: 100vh;
        position: fixed;
      }
      .sidebar h2 {
        text-align: center;
        padding: 20px 0;
        background: #212529;
        margin: 0;
      }
      .menu-item {
        padding: 15px 20px;
        border-bottom: 1px solid #4b545c;
        cursor: pointer;
        display: block;
        color: white;
        text-decoration: none;
      }
      .menu-item:hover {
        background: #495057;
      }
      .content {
        margin-left: 250px;
        padding: 20px;
        width: 100%;
      }

      /* Style ‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
      table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      th,
      td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }
      th {
        background-color: #6c757d;
        color: white;
      } /* ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å */
      tr:hover {
        background-color: #f1f1f1;
      }

      /* ‡∏õ‡∏∏‡πà‡∏° Action */
      .btn-edit {
        background: #ffc107;
        border: none;
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
      }
      .btn-delete {
        background: #dc3545;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
      }

      /* Modal ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç */
      #edit-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        align-items: center;
        justify-content: center;
      }
      .modal-content {
        background: white;
        padding: 20px;
        width: 300px;
        border-radius: 8px;
      }
      input {
        width: 90%;
        padding: 8px;
        margin: 5px 0;
      }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <h2>üõçÔ∏è POS Admin</h2>
      <a href="/admin" class="menu-item">üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</a>
      <a href="/stock" class="menu-item" style="background: #007bff"
        >üì¶ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å</a
      >
      <a href="/" class="menu-item" target="_blank">üíª ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á</a>
    </div>

    <div class="content">
      <h1>üì¶ ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h1>

      <table>
        <thead>
          <tr>
            <th>Barcode</th>
            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
            <th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏∏‡∏ô</th>
            <th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</th>
            <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
        </thead>
        <tbody id="stock-table"></tbody>
      </table>
    </div>

    <div id="edit-modal">
      <div class="modal-content">
        <h3>‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
        <input type="hidden" id="edit-id" />
        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
        <input type="text" id="edit-name" />
        <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏∏‡∏ô</label>
        <input type="number" id="edit-cost" />
        <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</label>
        <input type="number" id="edit-price" />
        <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å</label>
        <input type="number" id="edit-stock" style="background: #e9ecef" />

        <div style="margin-top: 15px; text-align: right">
          <button
            onclick="saveEdit()"
            style="
              background: green;
              color: white;
              padding: 8px 15px;
              border: none;
              cursor: pointer;
            "
          >
            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
          </button>
          <button
            onclick="closeModal()"
            style="
              background: #ccc;
              padding: 8px 15px;
              border: none;
              cursor: pointer;
            "
          >
            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
          </button>
        </div>
      </div>
    </div>

    <script>
      // 1. ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
      document.addEventListener("DOMContentLoaded", loadStock);

      async function loadStock() {
        const res = await fetch("/products"); // ‡πÉ‡∏ä‡πâ API ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
        const products = await res.json();

        const tbody = document.getElementById("stock-table");
        tbody.innerHTML = "";

        products.forEach((p) => {
          const row = document.createElement("tr");

          // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ï‡πá‡∏≠‡∏Å: ‡∏ñ‡πâ‡∏≤‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 10 ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏î‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
          const stockStyle =
            p.stock_qty < 10
              ? "color: red; font-weight: bold;"
              : "color: green;";

          row.innerHTML = `
                    <td>${p.barcode}</td>
                    <td>${p.name}</td>
                    <td>${p.cost_price}</td>
                    <td>${p.selling_price}</td>
                    <td style="${stockStyle}">${p.stock_qty}</td>
                    <td>
                        <button class="btn-edit" onclick='openEditModal(${JSON.stringify(
                          p
                        )})'>‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button class="btn-delete" onclick="deleteProduct(${
                          p.id
                        })">üóëÔ∏è ‡∏•‡∏ö</button>
                    </td>
                `;
          tbody.appendChild(row);
        });
      }

      // 2. ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡πà‡∏≤‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ä‡πà‡∏≠‡∏á)
      function openEditModal(product) {
        document.getElementById("edit-modal").style.display = "flex";

        document.getElementById("edit-id").value = product.id;
        document.getElementById("edit-name").value = product.name;
        document.getElementById("edit-cost").value = product.cost_price;
        document.getElementById("edit-price").value = product.selling_price;
        document.getElementById("edit-stock").value = product.stock_qty;
      }

      function closeModal() {
        document.getElementById("edit-modal").style.display = "none";
      }

      // 3. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (PUT)
      async function saveEdit() {
        const id = document.getElementById("edit-id").value;
        const body = {
          name: document.getElementById("edit-name").value,
          cost: document.getElementById("edit-cost").value,
          price: document.getElementById("edit-price").value,
          stock: document.getElementById("edit-stock").value,
        };

        const res = await fetch("/products/" + id, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body),
        });

        if (res.ok) {
          alert("‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
          closeModal();
          loadStock();
        } else {
          alert("‚ùå ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        }
      }

      //‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (DELETE)
      async function deleteProduct(id) {
        if (confirm("‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏ñ‡∏≤‡∏ß‡∏£‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
          const res = await fetch("/products/" + id, { method: "DELETE" });
          if (res.ok) {
            loadStock();
          } else {
            alert("‚ùå ‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
          }
        }
      }
    </script>
  </body>
</html>
